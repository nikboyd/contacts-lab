### Overview

| Package | Type | Summary |
|:------- |:---- |:------- |
| _**facets**_   | IContactService | defines this JAX-RS web service API |
| _**services**_ | ContactFacade   | manages contacts, phones, email and mailing addresses |
| _**server**_   | MainController  | launches this self-hosted web service |

### Discussion

The _**facets**_ package contains a web service interface definition: **IContactService**. 
The web service interface is a central organizational element, addressing several important
aspects of a web service design.
Using [JAX-RS][jax-rs] annotations, the interface defines the service [endpoint mappings][endpoints] 
for the service methods, thereby providing a RESTful API supporting JSON payloads.
The interface provides documentation that gets built and published automatically using the provided 
Java doc comments and [Enunciate][enunciate] during the Maven build process.

This web service design approach serves as an example of the [Separated Interface][separated-interface] and
[Plugin][plugin-pattern] design patterns.
The web service interface is separated out so that both the service implementation facade and its test client can
depend on and use the same interface.
Refer to the [model diagram](#model-diagram) below to see how these all relate to each other.

This design approach prevents clients from having direct dependence upon the service implementation class **ContactFacade**.
It also allows (at least) the test clients to use [Spring][spring] + [CXF][apache-cxf] to create 
a proxy based on the interface.
Such a proxy may reference a local service instance or a remote instance without code changes, only changes
in the proxy configuration.

The service also contains **MainController**, which takes advantage of [Spring Boot][spring-boot] 
to create a self-hosting service at launch.
The service API tests also use **MainController** to launch a local service instance for which 
the test then creates a local service proxy using [Spring][spring] + [CXF][apache-cxf] + **IContactService**.

### Contact Service API

To review the web service API docs generated by [Enunciate][enunciate], first [build this project][build].
After [building the web service][build], run the following commands in the project folder, which will 
launch the web service locally with logging to the terminal window.
After the web service launches, pressing **Control+C** in the terminal window will shut it down.

```
cd contacts-boot
java -jar target/contacts-boot*.jar
```

Note this launches the web service from the **contacts-boot** folder with the H2 database 
created during the [build][build] process and any residual data it contains.

After launching the web service, browse the API docs at [http://localhost:9001/docs/index.html][local-api].
Notice that the API docs are packaged and available with the running web service.
This allows the API docs to remain consistent with the delivered web service contained in its packaged JAR.
Consequently, client app developers will have relevant API docs published and available with each running instance of
the web service.

### Operating Locally

[Enunciate][enunciate] also provides a [Swagger][swagger] interface for exploring and testing the packaged 
and running web service.
The link for the Swagger interface is available on the API docs [Home][local-api] page.
While running the web service, you can use the published Swagger interface to explore and test out the various 
web service endpoints.
A few examples follow.

| Op  | Endpoint | Result |
|:--- |:-------- |:------ |
| **GET** | /contacts/count | a count of the contacts contained in the backing store |
| **GET** | /contacts/hash  | looks up a contact using a hash of its name |
| **POST** | /contacts/part | adds a contact or a contact mechanism depending on the description |

For example, POSTing the following JSON payload with **/contacts/part** will create a new contact.

```json
{ "name": "George Jungleman", "description": [ "name" ] }
```

Then, POSTing the following JSON payload with **/contacts/part** will add a HOME phone to that contact.

```json
{ "name": "George Jungleman", "description": [ "phone", "HOME", "415-897-8888" ] }
```

Finally, GETing **/contacts/hash?contactID=George%20Jungleman&idType=name** will read the contact you created from
the database backing store with a result like the following.

```json
[
  {
    "key": 7,
    "name": "George Jungleman",
    "mechanisms": [
      {
        "type": "HOME",
        "mechanism": {
          "phone": {
            "key": 8,
            "value": "415-897-8888"
          }
        }
      }
    ]
  }
]
```

Also, GETing **/contacts/count** will produce a result like the following where the key value shows the count.

```json
{ "key": 1, "type": "Contact.count" }
```

### Model Diagram
![Domain Model][model-diagram]

[build]: ../#building-this-project
[local-api]: http://localhost:9001/docs/index.html
[model-diagram]: ../images/contacts-service.png
[endpoints]: src/main/java/dev/educery/facets/IContactService.java#L29
[separated-interface]: http://martinfowler.com/eaaCatalog/separatedInterface.html
[plugin-pattern]: http://martinfowler.com/eaaCatalog/plugin.html
[jax-rs]: https://en.wikipedia.org/wiki/Jakarta_RESTful_Web_Services
[apache-cxf]: https://cxf.apache.org/
[enunciate]: http://enunciate.webcohesion.com/
[spring]: https://spring.io/projects/spring-framework
[spring-boot]: https://spring.io/projects/spring-boot
[swagger]: https://swagger.io/
